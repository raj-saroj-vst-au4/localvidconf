# =============================================================================
# Coturn TURN/STUN Server Configuration
# Provides NAT traversal for WebRTC connections
# Uses HMAC-based time-limited credentials for security
# =============================================================================

# --- Listening Configuration ---
# Listen on all interfaces (Docker will handle port mapping)
listening-port=3478
tls-listening-port=5349
listening-ip=0.0.0.0

# --- Relay Configuration ---
# UDP port range for media relay
# Keep this range as tight as possible in production to limit exposure
min-port=49152
max-port=65535

# --- Authentication ---
# Use TURN REST API (time-limited HMAC credentials)
# The media server generates temporary credentials using this shared secret
# This prevents credential theft/replay attacks
use-auth-secret
static-auth-secret=188b0497c76930c7a3a2507450bf841bdc886b33eef8094ec3b293c9642d8f7f

# --- Security ---
# Realm identifies this TURN server instance
realm=som.iitb.ac.in

# Disable plain-text TCP allocation to force encrypted connections
# (uncomment in production when TLS certs are available)
# no-tcp

# Prevent relay to private IP ranges (blocks SSRF attacks via TURN)
no-multicast-peers

# If coturn and the media server run on the SAME host (host network mode),
# the media server's ICE candidates use MEDIASOUP_ANNOUNCED_IP.
# When that IP falls in a denied range below, TURN relay will fail.
# Uncomment and set this to match MEDIASOUP_ANNOUNCED_IP in your .env:
allowed-peer-ip=10.127.1.30

denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255

# --- Logging ---
# Verbose logging for debugging; reduce in production
verbose

# --- Fingerprinting ---
# Required by WebRTC spec for STUN message integrity
fingerprint

# --- Long-term credential mechanism ---
lt-cred-mech
